version: 2.1

jobs:
  build-and-test:
    machine:
      image: ubuntu-2204:current
    steps:
      - checkout

      # Instalar Node.js y dependencias
      - run:
          name: Set up Node.js environment
          command: |
            curl -fsSL https://deb.nodesource.com/setup_20.x | bash -
            apt-get install -y nodejs
            npm install

      # Pruebas unitarias
      - run:
          name: Run unit tests
          command: |
            npm run test:unit

      # Pruebas de integraci√≥n
      - run:
          name: Run integration tests
          command: |
            npm run test:integration

      # Linter
      - run:
          name: Run linter
          command: |
            npm run lint

      # Build y push Docker
      - run:
          name: Build and Push Docker image
          command: |
            docker build -t $DOCKER_LOGIN/$IMAGE_NAME:$TAG .
            echo $DOCKER_PWD | docker login -u $DOCKER_LOGIN --password-stdin
            docker push $DOCKER_LOGIN/$IMAGE_NAME:$TAG

workflows:
  ci-cd:
    jobs:
      - build-and-test
